apiVersion: v1
kind: ConfigMap
metadata:
  name: mimir-config
  namespace: monitoring
data:
  mimir.yaml: |
    target: all
    multitenancy_enabled: true
    
    server:
      http_listen_port: 9009
      log_level: info
    
    common:
      storage:
        backend: filesystem
        filesystem:
          dir: /data/mimir
    
    blocks_storage:
      backend: filesystem
      filesystem:
        dir: /data/mimir/blocks
    
    compactor:
      data_dir: /data/mimir/compactor
      sharding_ring:
        kvstore:
          store: memberlist
    
    distributor:
      ring:
        kvstore:
          store: memberlist
    
    ingester:
      ring:
        kvstore:
          store: memberlist
        replication_factor: 1
    
    ruler:
      enable_api: true
      alertmanager_url: http://localhost:9009/alertmanager
      rule_path: /data/mimir/rules-data
    
    ruler_storage:
      backend: filesystem
      filesystem:
        dir: /data/mimir/rules
    
    # Multi-tenant AlertManager configuration
    alertmanager:
      enable_api: true
      data_dir: /data/mimir/alertmanager
      external_url: http://mimir:9009/alertmanager
      fallback_config_file: /etc/mimir-alertmanager/alertmanager-fallback.yaml
    
    alertmanager_storage:
      backend: filesystem
      filesystem:
        dir: /data/mimir/alertmanager-configs
    
    memberlist:
      cluster_label: mimir-cluster
      join_members: []
    
    limits:
      max_global_series_per_user: 0
      max_global_series_per_metric: 0

